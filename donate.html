<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Donate to Helmet Heads - Youth Cycling Program</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Support Helmet Heads - Help us empower South Carolina teenagers with bikes, community, and the freedom to explore. Your donation makes a difference.">
    <link rel="canonical" href="https://helmetheads.club/donate">
    
    <!-- Preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <link rel="stylesheet" href="styles.css?v=20251009">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"></noscript>
    
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-8FP0VQ2LC7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-8FP0VQ2LC7');
    </script>

    <!-- Microsoft Clarity tag -->
    <script type="text/javascript">
        window.addEventListener('load', function() {
            (function(c,l,a,r,i,t,y){
                c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
                t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
                y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
            })(window, document, "clarity", "script", "tn23wxt1i5");
        });
    </script>

    <!-- Meta Pixel (Facebook Ads) -->
    <script>
        window.addEventListener('load', function() {
            !function(f,b,e,v,n,t,s)
            {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
            n.callMethod.apply(n,arguments):n.queue.push(arguments)};
            if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
            n.queue=[];t=b.createElement(e);t.async=!0;
            t.src=v;s=b.getElementsByTagName(e)[0];
            s.parentNode.insertBefore(t,s)}(window, document,'script',
            'https://connect.facebook.net/en_US/fbevents.js');
            fbq('init', '828248643075397');
            fbq('track', 'PageView');
        });
    </script>
    <noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=828248643075397&ev=PageView&noscript=1" /></noscript>
    
    <!-- QR Landing Page Styles -->
    <style>
        .qr-page {
            min-height: 100vh;
            background: var(--light-color);
            padding: 1.5rem 0;
        }
        
        .qr-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .qr-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .qr-header-left {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .qr-logo {
            width: 60px;
            height: auto;
        }
        
        .qr-brand-name {
            font-family: 'Bebas Neue', cursive;
            font-size: 3rem;
            font-weight: 400;
            color: var(--accent-maroon);
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 0.02em;
        }
        
        /* Bicycle Animation */
        .bike-animation {
            width: 100px;
            height: 72px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .bike-animation canvas {
            width: 100%;
            height: 100%;
            filter: brightness(0) saturate(100%) invert(12%) sepia(25%) saturate(6701%) hue-rotate(338deg) brightness(99%) contrast(98%);
        }
        
        .qr-title {
            display: none;
        }
        
        .qr-subtitle {
            display: none;
        }
        
        /* Personalized pitch section */
        .qr-pitch {
            font-size: 1rem;
            line-height: 1.6;
            color: var(--dark-color);
            margin-bottom: 0.75rem;
            text-align: center;
        }
        
        .qr-pitch p {
            margin-bottom: 0.5rem;
        }
        
        .qr-pitch p:last-child {
            margin-bottom: 0;
        }
        
        .qr-cta {
            font-size: 1rem;
            line-height: 1.5;
            color: var(--dark-color);
            text-align: center;
            margin-bottom: 1.25rem;
            font-weight: 500;
        }
        
        /* CTA Button Container */
        .qr-cta-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 1.5rem auto 2rem auto;
            flex-wrap: wrap;
        }
        
        /* CTA Button Base Styles */
        .qr-cta-btn {
            flex: 1;
            min-width: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.625rem;
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            text-decoration: none;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            cursor: pointer;
            text-align: center;
        }
        
        .qr-cta-btn i {
            font-size: 1.125rem;
            flex-shrink: 0;
        }
        
        /* Primary Button - Green */
        .qr-cta-btn-primary {
            background: var(--primary-green);
            color: var(--white);
        }
        
        .qr-cta-btn-primary:hover {
            background: #248276;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(42, 157, 143, 0.4);
        }
        
        .qr-cta-btn-primary:active {
            transform: translateY(0);
        }
        
        /* Secondary Button - Maroon */
        .qr-cta-btn-secondary {
            background: var(--accent-maroon);
            color: var(--white);
        }
        
        .qr-cta-btn-secondary:hover {
            background: #8a1b22;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(113, 22, 28, 0.4);
        }
        
        .qr-cta-btn-secondary:active {
            transform: translateY(0);
        }
        
        /* Main content area for side-by-side layout on desktop */
        .qr-content-wrapper {
            display: flex;
            gap: 2rem;
            align-items: flex-start;
            margin-bottom: 0.5rem;
        }
        
        .qr-video-column {
            flex: 1;
        }
        
        .qr-signup-column {
            flex: 1;
            display: flex;
            justify-content: center;
        }
        
        /* Email signup widget - subtle background */
        .qr-widget-section {
            margin-bottom: 1rem;
            background: rgba(244, 237, 227, 0.3);
            border-radius: var(--border-radius);
            overflow: hidden;
            max-width: 520px;
            margin-left: auto;
            margin-right: auto;
        }
        
        /* Constrain GiveButter widget */
        .qr-widget-section givebutter-widget {
            display: block;
            max-width: 100%;
            width: 100%;
        }
        
        .qr-widget-section givebutter-widget iframe,
        .qr-widget-section givebutter-widget > div,
        .qr-widget-section givebutter-widget [class*="widget"],
        .qr-widget-section givebutter-widget [class*="container"],
        .qr-widget-section givebutter-widget [class*="wrapper"] {
            max-width: 100% !important;
            width: 100% !important;
            box-sizing: border-box !important;
        }
        
        /* Video section with custom play button */
        .qr-video-container {
            margin-bottom: 0;
            position: relative;
        }

        /* Keep portrait video constrained so the form stays a visual anchor on desktop */
        .qr-video-column .video-wrapper {
            max-width: 460px;
            margin: 0 auto;
        }
        
        .video-wrapper {
            position: relative;
            cursor: pointer;
            border-radius: var(--border-radius);
            overflow: hidden;
        }
        
        .qr-video {
            width: 100%;
            display: block;
            border-radius: var(--border-radius);
        }
        
        .video-play-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.4);
            transition: opacity 0.3s ease;
        }
        
        .video-play-overlay:hover {
            background: rgba(0, 0, 0, 0.5);
        }
        
        .video-play-overlay.hidden {
            display: none;
        }

        .video-play-overlay.fade-out {
            opacity: 0;
            pointer-events: none;
        }
        
        .play-button {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(113, 22, 28, 0.4);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            animation: pulse 2s ease-in-out infinite;
        }
        
        .video-play-overlay:hover .play-button {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(113, 22, 28, 0.5);
        }
        
        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 4px 20px rgba(113, 22, 28, 0.4);
            }
            50% {
                box-shadow: 0 4px 30px rgba(113, 22, 28, 0.6);
            }
        }
        
        .play-button i {
            color: var(--white);
            font-size: 2rem;
            margin-left: 5px;
        }
        
        .play-message {
            color: var(--white);
            text-align: center;
            margin-top: 0.75rem;
            font-size: 0.9rem;
            font-weight: 500;
            max-width: 300px;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
            transform: translateY(-8%);
        }

        /* Trust row and micro-stat under pitch */
        .qr-trust-row {
            display: flex;
            gap: 1rem;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            color: var(--gray-color);
            font-size: 0.9rem;
            margin: 0.5rem 0 0.5rem 0;
        }

        .qr-trust-row i {
            color: var(--primary-color);
            margin-right: 6px;
        }

        .qr-microstat {
            text-align: center;
            color: var(--dark-color);
            font-size: 0.95rem;
            margin: 0.25rem 0 0.75rem 0;
        }

        .donate-now {
            color: var(--primary-color);
            text-decoration: underline;
            cursor: pointer;
            white-space: nowrap;
        }

        .qr-donation-wrapper {
            margin-top: 1.25rem;
        }

        .qr-learn-more-wrapper {
            text-align: center;
            margin-top: 1.5rem;
        }

        .qr-donation-heading {
            font-family: 'Bebas Neue', cursive;
            font-size: 1.8rem;
            font-weight: 400;
            color: var(--dark-color);
            text-align: center;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.02em;
        }

        .qr-footer {
            margin-top: 2rem;
            padding-top: 1.5rem;
            padding-bottom: 1.5rem;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .qr-social-links {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1.25rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .qr-social-links a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-color);
            color: var(--white);
            text-decoration: none;
            transition: all 0.3s ease;
            font-size: 1.25rem;
        }

        .qr-social-links a:hover {
            background: var(--dark-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .share-btn {
            margin-top: 0.75rem;
            background: rgba(255,255,255,0.15);
            border: 2px solid #fff;
            color: #fff;
            padding: 8px 14px;
            border-radius: 999px;
            font-weight: 600;
            cursor: pointer;
        }
        
        /* Thank you message */
        .qr-thank-you {
            display: none;
            background: var(--gradient);
            color: var(--white);
            padding: 1.25rem;
            border-radius: var(--border-radius);
            margin-bottom: 0.75rem;
            text-align: center;
        }
        
        .qr-thank-you.show {
            display: block;
        }
        
        .qr-thank-you i {
            font-size: 2rem;
            margin-bottom: 0.75rem;
            display: block;
        }
        
        .qr-thank-you h3 {
            font-family: 'Bebas Neue', cursive;
            font-size: 1.5rem;
            font-weight: 400;
            margin-bottom: 0.5rem;
            color: var(--white);
            text-transform: uppercase;
            letter-spacing: 0.02em;
        }
        
        .qr-thank-you p {
            color: rgba(255, 255, 255, 0.95);
            margin: 0;
            font-size: 0.95rem;
        }
        
        /* Donation section (hidden until after signup) */
        .qr-donation-section {
            display: block;
        }
        
        /* Mobile optimizations */
        @media (max-width: 1024px) {
            .qr-content-wrapper {
                flex-direction: column;
                align-items: center;
            }
            .qr-video-column,
            .qr-signup-column {
                display: flex;
                justify-content: center;
                width: 100%;
            }
            .qr-cta-buttons {
                max-width: 460px; /* Match video wrapper width */
            }
        }

        @media (max-width: 768px) {
            .qr-page {
                padding: 1rem 0;
            }
            
            .qr-container {
                padding: 0 15px;
            }
            
            .qr-header {
                margin-bottom: 0.75rem;
                gap: 0.5rem;
            }
            
            .qr-logo {
                width: 50px;
            }
            
            .qr-brand-name {
                font-size: 2.5rem;
            }
            
            .bike-animation {
                width: 70px;
                height: 50px;
            }
            
            .qr-content-wrapper {
                flex-direction: column;
                gap: 1rem;
            }
            
            .qr-pitch {
                font-size: 0.95rem;
                margin-bottom: 0.75rem;
            }
            
            .qr-cta {
                font-size: 0.95rem;
                margin-bottom: 1rem;
            }
            
            .qr-cta-buttons {
                gap: 0.875rem;
            }
            
            .qr-cta-btn {
                font-size: 0.95rem;
                padding: 0.875rem 1.25rem;
            }
            
            .qr-widget-section {
                padding: 1rem;
            }
            
            .play-button {
                width: 80px;
                height: 80px;
            }
            
            .play-button i {
                font-size: 1.9rem;
            }
            
            .play-message {
                font-size: 0.85rem;
                max-width: 250px;
            }
            
            .qr-video-container {
                margin-bottom: 0.75rem;
            }

            .qr-donation-heading {
                font-size: 2rem;
            }

            .qr-footer {
                margin-top: 1.5rem;
                padding-top: 1.25rem;
            }

            .qr-social-links {
                gap: 1rem;
            }

            .qr-social-links a {
                width: 36px;
                height: 36px;
                font-size: 1.1rem;
            }
        }
        
        @media (max-width: 480px) {
            .qr-page {
                padding: 0.75rem 0;
            }

            .qr-header {
                margin-bottom: 0.5rem;
            }

            .qr-logo {
                width: 45px;
            }

            .qr-brand-name {
                font-size: 2.25rem;
            }
            
            .bike-animation {
                width: 70px;
                height: 50px;
            }
            
            .qr-pitch {
                font-size: 0.9rem;
                margin-bottom: 0.5rem;
            }
            
            .qr-cta {
                font-size: 0.9rem;
                margin-bottom: 0.75rem;
            }
            
            .qr-cta-buttons {
                flex-direction: column;
                gap: 0.75rem;
                margin: 1rem 0;
            }
            
            .qr-cta-btn {
                max-width: 100%;
                font-size: 0.9rem;
                padding: 0.875rem 1rem;
            }

            .qr-content-wrapper {
                gap: 0.75rem;
            }
            
            .qr-video-container {
                margin-bottom: 0.5rem;
            }

            .qr-donation-heading {
                font-size: 1.875rem;
            }

            .qr-donation-wrapper {
                margin-top: 1rem;
            }

            .qr-footer {
                margin-top: 1.25rem;
                padding-top: 1rem;
            }
            
            .play-button {
                width: 60px;
                height: 60px;
            }
            
            .play-button i {
                font-size: 1.5rem;
            }
        }
    </style>
</head>

<body>
    <div class="qr-page">
        <div class="qr-container">
            <!-- Header with logo and brand name -->
            <div class="qr-header">
                <div class="qr-header-left">
                    <img src="logo.svg" alt="Helmet Heads Logo" class="qr-logo">
                    <h1 class="qr-brand-name">Helmet Heads</h1>
                </div>
                <div class="bike-animation">
                    <canvas id="bike-canvas" width="140" height="100"></canvas>
                </div>
            </div>

            <!-- Personalized Pitch (dynamically updated by JavaScript) -->
            <div class="qr-pitch" id="personalized-pitch">
                <p><strong id="greeting-text">Welcome!</strong></p>
                <p>Helmet Heads is a nonprofit organization empowering South Carolina teenagers with bikes, community, and the freedom to explore through teacher-led cycling clubs.</p>
                <p>We've successfully raised initial funds and delivered bikes to students at BCHS in Cayce, but we want to raise more to help additional kids join the club and expand to other schools across South Carolina.</p>
            </div>

            <!-- Call to Action Buttons -->
            <div class="qr-cta-buttons">
                <a href="#signup-section" class="qr-cta-btn qr-cta-btn-primary">
                    <i class="fas fa-envelope"></i>
                    <span>Join Our Email List</span>
                </a>
                <a href="#donation-section" class="qr-cta-btn qr-cta-btn-secondary">
                    <i class="fas fa-heart"></i>
                    <span>Donate Now</span>
                </a>
            </div>

            <!-- Thank You Message (hidden initially) -->
            <div class="qr-thank-you" id="thank-you-message">
                <i class="fas fa-check-circle"></i>
                <h3>Thank You!</h3>
                <p>We've added you to our mailing list. If you're able, please consider making a donation below.</p>
                <button id="share-btn" class="share-btn" type="button">Share this page</button>
            </div>

            <!-- Content wrapper for side-by-side layout on desktop -->
            <div class="qr-content-wrapper">
                <!-- Video Column -->
                <div class="qr-video-column">
                    <div class="qr-video-container">
                        <div class="video-wrapper" id="video-wrapper">
                            <video class="qr-video" id="pitch-video" poster="helmetheads-elevator-pitch-still.avif" preload="metadata">
                                <source src="helmetheads-elevator-pitch.mp4" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                            <div class="video-play-overlay" id="video-overlay">
                                <div class="play-button">
                                    <i class="fas fa-play"></i>
                                </div>
                                <p class="play-message">Watch to learn what we do<br>(30 sec, has captions)</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Signup Column -->
                <div class="qr-signup-column">
                    <!-- Email Signup Widget -->
                    <div class="qr-widget-section" id="signup-section">
                        <givebutter-widget id="j2GvyL"></givebutter-widget>
                    </div>
                </div>
            </div>

            <!-- Donation Widget -->
            <div class="qr-donation-wrapper">
                <h2 class="qr-donation-heading">Donate Now</h2>
                <div class="qr-widget-section qr-donation-section" id="donation-section">
                    <givebutter-widget id="prm4Gg"></givebutter-widget>
                </div>
                <div class="qr-learn-more-wrapper">
                    <a href="/" class="btn btn-secondary">Visit Main Helmet Heads Website</a>
                </div>
            </div>

            <!-- Footer -->
            <footer class="qr-footer">
                <div class="qr-trust-row">
                    <span><i class="fas fa-shield-alt"></i>501(c)(3)</span>
                    <span><i class="fas fa-id-badge"></i>EIN 39-4010571</span>
                    <span><i class="fas fa-check-circle"></i>SC Charity ID P94445</span>
                </div>
                <div class="qr-social-links">
                    <a href="https://www.instagram.com/helmetheadsclub" target="_blank" rel="noopener noreferrer" aria-label="Instagram">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="https://www.facebook.com/helmetheadsclub" target="_blank" rel="noopener noreferrer" aria-label="Facebook">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="https://www.linkedin.com/company/helmetheads" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn">
                        <i class="fab fa-linkedin"></i>
                    </a>
                    <a href="https://www.youtube.com/@HelmetHeadsClub" target="_blank" rel="noopener noreferrer" aria-label="YouTube">
                        <i class="fab fa-youtube"></i>
                    </a>
                    <a href="https://www.tiktok.com/@helmetheadsclub" target="_blank" rel="noopener noreferrer" aria-label="TikTok">
                        <i class="fab fa-tiktok"></i>
                    </a>
                </div>
            </footer>
        </div>
    </div>

    <script src="script.js?v=20251009"></script>
    <script defer src="https://widgets.givebutter.com/latest.umd.cjs?acct=SqUcaiaJOyN4QAIZ&p=other"></script>
    
    <!-- QR Landing Page Script -->
    <script>
        // Location-based personalization mapping
        const locationGreetings = {
            '1': 'Thanks for visiting!',
            '2': 'Hello from Cola Town Bike Collective!',
            '3': 'Hello fellow Indah Coffee lover!',
            'default': 'Welcome!'
        };

        // Parse location parameter from URL
        function getLocationParam() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('loc') || 'unknown';
        }

        // Set personalized greeting based on location
        function setPersonalizedGreeting() {
            const locationId = getLocationParam();
            const greetingText = document.getElementById('greeting-text');
            
            if (greetingText) {
                const greeting = locationGreetings[locationId] || locationGreetings['default'];
                greetingText.textContent = greeting;
            }
        }

        // Custom video play button functionality
        function initializeVideoPlayer() {
            const video = document.getElementById('pitch-video');
            const overlay = document.getElementById('video-overlay');
            const wrapper = document.getElementById('video-wrapper');
            
            if (!video || !overlay || !wrapper) return;
            
            // Click handler for play button
            wrapper.addEventListener('click', function() {
                if (video.paused) {
                    video.play();
                    // Fade overlay then hide
                    overlay.classList.add('fade-out');
                    setTimeout(() => {
                        overlay.classList.add('hidden');
                        overlay.classList.remove('fade-out');
                    }, 400);
                    video.setAttribute('controls', 'controls');
                }
            });
            
            // Show overlay again if video is paused
            video.addEventListener('pause', function() {
                if (video.currentTime < video.duration - 0.5) {
                    overlay.classList.remove('hidden');
                }
            });
            
            // Hide overlay when video ends
            video.addEventListener('ended', function() {
                overlay.classList.remove('hidden');
                video.removeAttribute('controls');
            });

            // Video analytics: play + quartiles
            let q25 = false, q50 = false, q100 = false, playLogged = false;
            video.addEventListener('play', function() {
                if (!playLogged) {
                    const locationId = getLocationParam();
                    if (typeof gtag !== 'undefined') {
                        gtag('event', 'video_play', {
                            'event_category': 'Video',
                            'event_label': 'Donation Pitch',
                            'location_id': locationId
                        });
                    }
                    if (typeof fbq !== 'undefined') {
                        fbq('track', 'ViewContent', { content_name: 'Donation Pitch Video', location_id: getLocationParam() });
                    }
                    playLogged = true;
                }
            });
            video.addEventListener('timeupdate', function() {
                if (!video.duration) return;
                const p = (video.currentTime / video.duration) * 100;
                const locationId = getLocationParam();
                if (!q25 && p >= 25) {
                    q25 = true;
                    if (typeof gtag !== 'undefined') gtag('event', 'video_progress', { percent: 25, location_id: locationId });
                }
                if (!q50 && p >= 50) {
                    q50 = true;
                    if (typeof gtag !== 'undefined') gtag('event', 'video_progress', { percent: 50, location_id: locationId });
                }
                if (!q100 && p >= 99) {
                    q100 = true;
                    if (typeof gtag !== 'undefined') gtag('event', 'video_complete', { location_id: locationId });
                }
            });
        }

        // Track page view with location
        document.addEventListener('DOMContentLoaded', function() {
            const locationId = getLocationParam();
            
            // Set personalized greeting
            setPersonalizedGreeting();
            
            // Initialize video player
            initializeVideoPlayer();
            
            // Track in Google Analytics
            if (typeof gtag !== 'undefined') {
                gtag('event', 'page_view', {
                    'event_category': 'Donation Page',
                    'event_label': 'Location ' + locationId,
                    'location_id': locationId
                });
                
                gtag('config', 'G-8FP0VQ2LC7', {
                    'custom_map': {'location_id': locationId}
                });
            }
            
            // Track in Meta Pixel
            if (typeof fbq !== 'undefined') {
                fbq('track', 'ViewContent', {
                    content_name: 'Donation Landing Page',
                    content_category: 'Donation Page',
                    location_id: locationId
                });
            }
            
            // Track in Microsoft Clarity
            if (typeof clarity !== 'undefined') {
                clarity('set', 'location_id', locationId);
            }
        });

        // Unified GiveButter Success Handler
        function handleGiveButterSuccess(event) {
            console.log('GiveButter Success Event Detected:', event);
            
            // Normalize data from CustomEvent or MessageEvent
            let data = event.detail || event.data;
            if (data && data.givebutter) data = data.givebutter; // Handle postMessage wrapping
            
            console.log('GiveButter Event Data:', data);
            
            // Check for donation vs signup
            // Donations typically have an 'amount' field > 0
            const isDonation = data && (data.amount > 0 || data.plan_id);
            
            // Get location for analytics
            const locationId = getLocationParam();

            if (isDonation) {
                // --- DONATION TRACKING ---
                console.log('Tracking Donation:', data.amount);
                
                if (typeof gtag !== 'undefined') {
                    console.log('Firing GA Purchase Event');
                    gtag('event', 'purchase', {
                        'transaction_id': data.id || ('don_' + Date.now()),
                        'value': parseFloat(data.amount || 0),
                        'currency': 'USD',
                        'event_category': 'Donation',
                        'event_label': 'Location ' + locationId,
                        'location_id': locationId
                    });
                } else {
                    console.warn('Google Analytics (gtag) not loaded');
                }
                
                if (typeof fbq !== 'undefined') {
                    console.log('Firing Facebook Pixel Purchase Event');
                    fbq('track', 'Purchase', {
                        value: parseFloat(data.amount || 0),
                        currency: 'USD',
                        content_name: 'Bike Donation',
                        content_type: 'donation',
                        location_id: locationId
                    });
                } else {
                    console.warn('Facebook Pixel (fbq) not loaded');
                }
                
            } else {
                // --- SIGNUP TRACKING ---
                console.log('Tracking Signup');
                
                if (typeof gtag !== 'undefined') {
                    console.log('Firing GA Email Signup Event');
                    gtag('event', 'email_signup', {
                        'event_category': 'Conversion',
                        'event_label': 'Location ' + locationId,
                        'location_id': locationId
                    });
                } else {
                    console.warn('Google Analytics (gtag) not loaded');
                }
                
                if (typeof fbq !== 'undefined') {
                    console.log('Firing Facebook Pixel Subscribe Event');
                    fbq('track', 'Subscribe', {
                        location_id: locationId
                    });
                } else {
                    console.warn('Facebook Pixel (fbq) not loaded');
                }

                // Show local Thank You UI for signups
                const thankYouMessage = document.getElementById('thank-you-message');
                const donationSection = document.getElementById('donation-section');
                
                if (thankYouMessage && !thankYouMessage.classList.contains('show')) {
                    console.log('Showing Thank You Message');
                    thankYouMessage.classList.add('show');
                    thankYouMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    
                    // Nudge towards donation after a delay
                    setTimeout(function() {
                        if (donationSection) {
                            console.log('Scrolling to Donation Section');
                            donationSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                    }, 1200);
                }
            }
        }

        // Listen for postMessage events from GiveButter iframe
        window.addEventListener('message', function(event) {
            // Log all GiveButter-related messages for debugging
            if (event.data && (
                (typeof event.data === 'string' && event.data.includes('givebutter')) ||
                (event.data.type && event.data.type.includes('givebutter')) ||
                event.data.givebutter
            )) {
                console.log('Raw GiveButter Message Received:', event.data);
            }

            if (event.data && (
                event.data.type === 'givebutter:form:success' ||
                event.data.type === 'givebutter:success' ||
                (event.data.givebutter && event.data.givebutter.success)
            )) {
                handleGiveButterSuccess(event);
            }
        });

        // Listen for direct custom events (if widget is not in iframe)
        document.addEventListener('givebutter:form:success', handleGiveButterSuccess);
        document.addEventListener('givebutter:success', handleGiveButterSuccess);

        /* Legacy fallback polling removed for cleaner event-based approach */
        
        // Expose function globally
        window.givebutterSuccess = handleGiveButterSuccess;
        document.addEventListener('click', function(e) {
            if (e.target.closest('givebutter-widget[id="prm4Gg"]')) {
                const locationId = getLocationParam();
                
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'begin_checkout', {
                        'event_category': 'Donation',
                        'event_label': 'Location ' + locationId,
                        'location_id': locationId
                    });
                }
                
                if (typeof fbq !== 'undefined') {
                    fbq('track', 'InitiateCheckout', {
                        content_name: 'Bike Donation',
                        content_category: 'Donation',
                        location_id: locationId
                    });
                }
            }
        });

        // 'Donate now' anchor tracking + smooth scroll
        document.addEventListener('click', function(e) {
            const anchor = e.target.closest('a[href="#donation-section"]');
            if (anchor) {
                const donationSection = document.getElementById('donation-section');
                if (donationSection) {
                    e.preventDefault();
                    donationSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
                const locationId = getLocationParam();
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'donate_now_click', {
                        'event_category': 'CTA',
                        'event_label': 'Donate Now Link',
                        'location_id': locationId
                    });
                }
                if (typeof fbq !== 'undefined') {
                    fbq('trackCustom', 'DonateNowClick', { location_id: locationId });
                }
            }
        });

        // Share button after signup
        document.addEventListener('click', async function(e) {
            const shareBtn = e.target.closest('#share-btn');
            if (shareBtn) {
                const shareData = {
                    title: 'Helmet Heads',
                    text: 'I just discovered Helmet Heads - helping teens get bikes via school clubs. Check it out:',
                    url: window.location.href
                };
                try {
                    if (navigator.share) {
                        await navigator.share(shareData);
                    } else {
                        await navigator.clipboard.writeText(window.location.href);
                        alert('Link copied to clipboard!');
                    }
                } catch (err) { /* no-op */ }
            }
        });
        
        // Track donation interactions
    </script>

    <!-- Initialize DotLottie animation -->
    <script type="module">
        import { DotLottie } from "https://cdn.jsdelivr.net/npm/@lottiefiles/dotlottie-web/+esm";

        const canvas = document.getElementById("bike-canvas");
        if (canvas) {
            new DotLottie({
                autoplay: true,
                loop: true,
                canvas: canvas,
                src: "yellow-bike.lottie"
            });
        }
    </script>
</body>

</html>
