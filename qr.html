<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Join Helmet Heads - Youth Cycling Program</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Join Helmet Heads - A 501(c)(3) nonprofit empowering South Carolina teenagers with bikes, community, and the freedom to explore.">
    <link rel="canonical" href="https://helmetheads.club/qr">
    
    <!-- Preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <link rel="stylesheet" href="styles.css?v=20251009">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"></noscript>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-8FP0VQ2LC7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-8FP0VQ2LC7');
    </script>

    <!-- Microsoft Clarity tag -->
    <script type="text/javascript">
        window.addEventListener('load', function() {
            (function(c,l,a,r,i,t,y){
                c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
                t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
                y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
            })(window, document, "clarity", "script", "tn23wxt1i5");
        });
    </script>

    <!-- Meta Pixel (Facebook Ads) -->
    <script>
        window.addEventListener('load', function() {
            !function(f,b,e,v,n,t,s)
            {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
            n.callMethod.apply(n,arguments):n.queue.push(arguments)};
            if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
            n.queue=[];t=b.createElement(e);t.async=!0;
            t.src=v;s=b.getElementsByTagName(e)[0];
            s.parentNode.insertBefore(t,s)}(window, document,'script',
            'https://connect.facebook.net/en_US/fbevents.js');
            fbq('init', '828248643075397');
            fbq('track', 'PageView');
        });
    </script>
    <noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=828248643075397&ev=PageView&noscript=1" /></noscript>
    
    <!-- QR Landing Page Styles -->
    <style>
        .qr-page {
            min-height: 100vh;
            background: var(--light-color);
            padding: 2rem 0;
        }
        
        .qr-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .qr-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .qr-logo {
            width: 80px;
            height: auto;
            margin-bottom: 1.5rem;
        }
        
        .qr-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark-color);
            margin-bottom: 0.5rem;
        }
        
        .qr-subtitle {
            font-size: 1.125rem;
            color: var(--gray-color);
            margin-bottom: 2rem;
        }
        
        .qr-section {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .qr-video-container {
            margin-bottom: 2rem;
        }
        
        .qr-video {
            width: 100%;
            border-radius: var(--border-radius);
        }
        
        .qr-summary {
            line-height: 1.8;
            color: var(--gray-color);
            font-size: 1rem;
        }
        
        .qr-summary h3 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 1rem;
        }
        
        .qr-summary p {
            margin-bottom: 1rem;
        }
        
        .qr-summary p:last-child {
            margin-bottom: 0;
        }
        
        .qr-widget-section {
            margin-bottom: 2rem;
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }
        
        /* Constrain GiveButter widget to match section width */
        .qr-widget-section givebutter-widget {
            display: block;
            max-width: 100%;
            width: 100%;
        }
        
        /* Target GiveButter widget iframe and internal containers */
        .qr-widget-section givebutter-widget iframe,
        .qr-widget-section givebutter-widget > div,
        .qr-widget-section givebutter-widget [class*="widget"],
        .qr-widget-section givebutter-widget [class*="container"],
        .qr-widget-section givebutter-widget [class*="wrapper"] {
            max-width: 100% !important;
            width: 100% !important;
            box-sizing: border-box !important;
        }
        
        .qr-thank-you {
            display: none;
            background: var(--gradient);
            color: var(--white);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .qr-thank-you.show {
            display: block;
        }
        
        .qr-thank-you i {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            display: block;
        }
        
        .qr-thank-you h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--white);
        }
        
        .qr-thank-you p {
            color: rgba(255, 255, 255, 0.95);
            margin: 0;
        }
        
        .qr-widget-container {
            margin: 0 auto;
            max-width: 600px;
        }
        
        .qr-donation-section {
            display: none;
        }
        
        .qr-donation-section.show {
            display: block;
        }
        
        @media (max-width: 768px) {
            .qr-page {
                padding: 1rem 0;
            }
            
            .qr-container {
                padding: 0 15px;
            }
            
            .qr-title {
                font-size: 1.5rem;
            }
            
            .qr-subtitle {
                font-size: 1rem;
            }
            
            .qr-section {
                padding: 1.5rem;
            }
        }
    </style>
</head>

<body>
    <div class="qr-page">
        <div class="qr-container">
            <!-- Header -->
            <div class="qr-header">
                <img src="logo.svg" alt="Helmet Heads Logo" class="qr-logo">
                <h1 class="qr-title">Welcome to Helmet Heads</h1>
                <p class="qr-subtitle">Empowering South Carolina teenagers with bikes, community, and the freedom to explore</p>
            </div>

            <!-- Video Section -->
            <div class="qr-video-container">
                <video class="qr-video" controls poster="helmetheads-elevator-pitch-still.avif" preload="metadata">
                    <source src="helmetheads-elevator-pitch.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>

            <!-- Summary Section -->
            <div class="qr-section">
                <div class="qr-summary">
                    <h3>About Helmet Heads</h3>
                    <p>
                        Helmet Heads is a 501(c)(3) nonprofit organization that empowers South Carolina teenagers through cycling. We provide bikes, safety gear, and community support to help students build confidence, physical fitness, and lasting friendships.
                    </p>
                    <p>
                        Our pilot program at BCHS in Cayce is helping us refine our approach before expanding to other schools across South Carolina. We're currently fundraising to get 20 students on bikes.
                    </p>
                </div>
            </div>

            <!-- Thank You Message (hidden initially) -->
            <div class="qr-thank-you" id="thank-you-message">
                <i class="fas fa-check-circle"></i>
                <h3>Thank You!</h3>
                <p>We've added you to our mailing list. If you're able, please consider making a donation to help us get more students on bikes.</p>
            </div>

            <!-- Email Signup Widget Section -->
            <div class="qr-widget-section" id="signup-section">
                <givebutter-widget id="j2GvyL"></givebutter-widget>
            </div>

            <!-- Donation Widget Section (hidden initially) -->
            <div class="qr-widget-section qr-donation-section" id="donation-section">
                <givebutter-widget id="prm4Gg"></givebutter-widget>
            </div>
        </div>
    </div>

    <script src="script.js?v=20251009"></script>
    <script defer src="https://widgets.givebutter.com/latest.umd.cjs?acct=SqUcaiaJOyN4QAIZ&p=other"></script>
    
    <!-- QR Landing Page Script -->
    <script>
        // Parse location parameter from URL
        function getLocationParam() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('loc') || 'unknown';
        }

        // Track page view with location
        document.addEventListener('DOMContentLoaded', function() {
            const locationId = getLocationParam();
            
            // Track in Google Analytics
            if (typeof gtag !== 'undefined') {
                gtag('event', 'qr_scan', {
                    'event_category': 'QR Code',
                    'event_label': 'Location ' + locationId,
                    'location_id': locationId
                });
                
                // Set custom dimension for location (if configured)
                gtag('config', 'G-8FP0VQ2LC7', {
                    'custom_map': {'location_id': locationId}
                });
            }
            
            // Track in Meta Pixel
            if (typeof fbq !== 'undefined') {
                fbq('track', 'ViewContent', {
                    content_name: 'QR Landing Page',
                    content_category: 'QR Code',
                    location_id: locationId
                });
            }
            
            // Track in Microsoft Clarity (via custom event)
            if (typeof clarity !== 'undefined') {
                clarity('set', 'location_id', locationId);
            }
        });

        // Handle email signup success
        function handleSignupSuccess() {
            const signupSection = document.getElementById('signup-section');
            const donationSection = document.getElementById('donation-section');
            const thankYouMessage = document.getElementById('thank-you-message');
            
            if (!signupSection || !donationSection || !thankYouMessage) return;
            
            // Prevent duplicate triggers
            if (thankYouMessage.classList.contains('show')) return;
            
            // Show thank you message
            thankYouMessage.classList.add('show');
            
            // Scroll to thank you message
            thankYouMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
            
            // Track conversion
            const locationId = getLocationParam();
            
            if (typeof gtag !== 'undefined') {
                gtag('event', 'email_signup', {
                    'event_category': 'Conversion',
                    'event_label': 'Location ' + locationId,
                    'location_id': locationId
                });
            }
            
            if (typeof fbq !== 'undefined') {
                fbq('track', 'Subscribe', {
                    location_id: locationId
                });
            }
            
            // Hide signup section and show donation section after a delay
            setTimeout(function() {
                signupSection.style.display = 'none';
                donationSection.classList.add('show');
                
                // Scroll to donation section
                donationSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 1500);
        }

        // Listen for postMessage events from GiveButter iframe
        window.addEventListener('message', function(event) {
            // GiveButter may send success messages
            if (event.data && (
                event.data.type === 'givebutter:form:success' ||
                event.data.type === 'givebutter:success' ||
                (event.data.givebutter && event.data.givebutter.success)
            )) {
                handleSignupSuccess();
            }
        });

        // Poll for success indicators in the DOM
        // This is a fallback method that works even if message events don't fire
        let checkCount = 0;
        const maxChecks = 60; // Check for 30 seconds (60 * 500ms)
        const thankYouMessage = document.getElementById('thank-you-message');
        
        const checkSignupSuccess = setInterval(function() {
            checkCount++;
            
            // Skip if already handled
            if (thankYouMessage && thankYouMessage.classList.contains('show')) {
                clearInterval(checkSignupSuccess);
                return;
            }
            
            // Look for success indicators in the DOM
            const signupWidget = document.querySelector('givebutter-widget[id="j2GvyL"]');
            if (signupWidget) {
                const widgetContainer = signupWidget.closest('.qr-widget-container');
                if (widgetContainer) {
                    // Check for common success indicators
                    const successIndicators = widgetContainer.querySelectorAll(
                        '[class*="success"], [class*="thank"], [class*="complete"], [class*="submitted"], ' +
                        '[class*="done"], [id*="success"], [id*="thank"], ' +
                        'iframe[src*="success"], iframe[src*="thank"]'
                    );
                    
                    // Also check for text content that indicates success
                    const widgetText = widgetContainer.textContent || '';
                    const successTexts = ['thank you', 'success', 'subscribed', 'you\'re in', 'you\'re all set'];
                    const hasSuccessText = successTexts.some(text => 
                        widgetText.toLowerCase().includes(text)
                    );
                    
                    if ((successIndicators.length > 0 || hasSuccessText) && 
                        widgetText.length > 50) { // Make sure widget has loaded
                        handleSignupSuccess();
                        clearInterval(checkSignupSuccess);
                    }
                }
            }
            
            if (checkCount >= maxChecks) {
                clearInterval(checkSignupSuccess);
            }
        }, 500);

        // Also listen for custom events that might be dispatched
        document.addEventListener('givebutter:form:success', handleSignupSuccess);
        document.addEventListener('givebutter:success', handleSignupSuccess);
        
        // Expose function globally in case GiveButter widget calls it directly
        window.givebutterSignupSuccess = handleSignupSuccess;
        
        // Track donation interactions
        document.addEventListener('click', function(e) {
            // Check if click is on donation widget
            if (e.target.closest('givebutter-widget[id="prm4Gg"]')) {
                const locationId = getLocationParam();
                
                // Track donation intent
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'begin_checkout', {
                        'event_category': 'Donation',
                        'event_label': 'Location ' + locationId,
                        'location_id': locationId
                    });
                }
                
                if (typeof fbq !== 'undefined') {
                    fbq('track', 'InitiateCheckout', {
                        content_name: 'Bike Donation',
                        content_category: 'Donation',
                        location_id: locationId
                    });
                }
            }
        });
        
        // Track successful donations (if GiveButter exposes this)
        window.givebutterDonationSuccess = function(data) {
            const locationId = getLocationParam();
            
            if (typeof gtag !== 'undefined') {
                gtag('event', 'purchase', {
                    'transaction_id': data.id || 'unknown',
                    'value': data.amount || 0,
                    'currency': 'USD',
                    'event_category': 'Donation',
                    'event_label': 'Location ' + locationId,
                    'location_id': locationId
                });
            }
            
            if (typeof fbq !== 'undefined') {
                fbq('track', 'Purchase', {
                    value: data.amount || 0,
                    currency: 'USD',
                    content_name: 'Bike Donation',
                    content_type: 'donation',
                    location_id: locationId
                });
            }
        };
    </script>
</body>

</html>
